<%# app/views/fields/geojson/_display.html.erb %>
<% 
  # This partial renders a GeoJSON field in display-only mode
  # It can be used in show pages and index pages
  
  # Parameters:
  # - record: The record containing the GeoJSON data
  # - method: The attribute name
  # - options: Additional options for the field
  
  # Default options
  options ||= {}
  
  # Get the current value
  value = record.send(method)
  
  # Set up Mapbox API key
  api_key = ENV["MAPBOX_API_KEY"]
  
  # Set default map options
  map_height = options[:height] || "300px"
  center = options[:center] || [-122.4194, 37.7749] # Default: San Francisco
  zoom = options[:zoom] || 12
%>

<% if value.present? %>
  <div data-controller="bullet-train--fields--geojson--map-display"
       data-bullet-train--fields--geojson--map-display-api-key-value="<%= api_key %>"
       data-bullet-train--fields--geojson--map-display-center-value="<%= center.to_json %>"
       data-bullet-train--fields--geojson--map-display-zoom-value="<%= zoom %>"
       data-bullet-train--fields--geojson--map-display-geojson-value="<%= {
         type: "Feature",
         geometry: value,
         properties: {
           id: record.id,
           model_name: record.class.name,
           field_name: method
         }
       }.to_json %>">
    
    <div data-bullet-train--fields--geojson--map-display-target="map" 
         style="height: <%= map_height %>; width: 100%; border-radius: 0.375rem;"></div>
    
    <div data-bullet-train--fields--geojson--map-display-target="info" 
         class="text-sm mt-2"></div>
  </div>
<% else %>
  <p class="help text-gray-500">No location data available</p>
<% end %>